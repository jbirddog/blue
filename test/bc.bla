
include "../tools/bth/bth.inc"

test

litw '01'
plan

;
; test compiling and calling bytecode
;

comp
endcomp
depth
litb 0x01
eq
comp
	ok
endcomp
comp
	notok
endcomp
ifelse
drop

comp
endcomp
atb
litb ret.code
eq
comp
endcomp
comp
	litb 0x02
	exit
endcomp
ifelse

comp
endcomp
call

comp
	comp
	endcomp
	call
endcomp
call

comp
	comp
		comp
		endcomp
		call
	endcomp
	call
endcomp
call

comp
	comp
		comp
			comp
			endcomp
			call
		endcomp
		call
	endcomp
	call
endcomp
call

comp
	comp
		comp
			comp
				comp
				endcomp
				call
			endcomp
			call
		endcomp
		call
	endcomp
	call
endcomp
call

comp
	comp
		comp
			comp
				comp
					comp
					endcomp
					call
				endcomp
				call
			endcomp
			call
		endcomp
		call
	endcomp
	call
endcomp
call

comp
endcomp
dup
litb 0x01
sub
atb
litb setip.code
eq
comp
endcomp
comp
	litb 0x03
	exit
endcomp
ifelse
dup
litb 0x0A
sub
atb
litb litq.code
eq
comp
endcomp
comp
	litb 0x04
	exit
endcomp
ifelse
comp
	drop
endcomp
call

litb 0x01
litb 0x02
comp
	add
endcomp
call

litb 0x03
eq
comp
endcomp
comp
	litb 0x05
	exit
endcomp
ifelse

litb 0x04
litb 0x05
comp
	comp
		comp
			add
		endcomp
		call
	endcomp
	call
endcomp
call

litb 0x09
eq
comp
endcomp
comp
	litb 0x06
	exit
endcomp
ifelse

litb 0x01
comp
	litb 0x03
	eq
	comp
		comp
			litb 0x07
			exit
		endcomp
		comp
		endcomp
		ifelse
	endcomp
	call
endcomp
call

comp
endcomp
here
swap
call
here
eq
comp
endcomp
comp
	litb 0x08
	exit
endcomp
ifelse

done
